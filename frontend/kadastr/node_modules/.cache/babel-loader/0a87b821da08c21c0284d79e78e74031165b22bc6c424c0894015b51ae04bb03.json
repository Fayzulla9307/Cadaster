{"ast":null,"code":"import axios from \"axios\";\nimport BootstrapIcon from \"@dvuckovic/vue3-bootstrap-icons\";\nimport NewDepositModal from \"../components/NewDepositModal.vue\";\nimport EditDepositModal from \"../components/EditDepositModal.vue\";\nimport DepositItem from \"../components/DepositItem.vue\";\nimport Paginator from \"../components/Paginator.vue\";\nimport Filter from \"../components/Filter.vue\";\nimport Spinner from \"../components/Spinner.vue\";\nimport OkModal from \"./OkModal.vue\";\nexport default {\n  name: \"DepositsTable\",\n  props: [],\n  watch: {},\n  data() {\n    return {\n      items: [],\n      totalItems: 0,\n      showAddNewDeposit: false,\n      showEditDeposit: false,\n      currentDepositId: null,\n      page: 1,\n      ipp: 10,\n      filter: \"\",\n      loadedItems: 0,\n      showSpinner: true,\n      showAuthError: false,\n      authMessage: \"Доступ запрещен\",\n      authHeader: \"Ошибка безопасности\"\n    };\n  },\n  methods: {\n    hideAuthMessage() {\n      this.showAuthError = false;\n    },\n    countItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/get_deposits_count/\";\n      axios.post(url, {\n        deposit_name: this.filter\n      }, {\n        headers\n      }).then(response => {\n        if (!response.data[0].auth_fail) {\n          this.totalItems = response.data[0].result;\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    loadItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/get_deposits/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios.post(url, {\n        deposit_name: this.filter,\n        offset: offset,\n        limit: this.ipp\n      }, {\n        headers\n      }).then(response => {\n        if (!response.data[0].auth_fail) {\n          this.items = response.data[0].result;\n          this.loadedItems = 0;\n          this.showSpinner = false;\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    changePage(o) {\n      this.page = o.page;\n      this.loadItems();\n    },\n    onDeleted() {\n      this.page = 1;\n      this.filter = \"\";\n      this.countItems();\n      this.loadItems();\n    },\n    onEdit(o) {\n      this.currentDepositId = o.deposit_id;\n      this.showEditDeposit = true;\n    },\n    onNew() {\n      this.showAddNewDeposit = true;\n    },\n    filterTable(filter) {\n      this.page = 1;\n      this.filter = filter;\n      this.countItems();\n      this.loadItems();\n    },\n    closeAddNew() {\n      this.showAddNewDeposit = false;\n    },\n    saveNew(deposit) {\n      this.showAddNewDeposit = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/add_deposit/\";\n      axios.post(url, deposit, {\n        headers\n      }).then(response => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    updateExisting(deposit) {\n      this.showEditDeposit = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/update_deposit/\";\n      axios.post(url, deposit, {\n        headers\n      }).then(response => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.items = [];\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    closeUpdate() {\n      this.showEditDeposit = false;\n    },\n    onEditReservesForDeposit(o) {\n      this.currentDepositId = o.deposit_id;\n    }\n  },\n  components: {\n    BootstrapIcon,\n    EditDepositModal,\n    NewDepositModal,\n    DepositItem,\n    Paginator,\n    Filter,\n    Spinner,\n    OkModal\n  },\n  mounted() {\n    this.showSpinner = true;\n    this.countItems();\n    this.loadItems();\n  }\n};","map":{"version":3,"names":["axios","BootstrapIcon","NewDepositModal","EditDepositModal","DepositItem","Paginator","Filter","Spinner","OkModal","name","props","watch","data","items","totalItems","showAddNewDeposit","showEditDeposit","currentDepositId","page","ipp","filter","loadedItems","showSpinner","showAuthError","authMessage","authHeader","methods","hideAuthMessage","countItems","token","sessionStorage","getItem","headers","Authorization","url","$BASE_URL","post","deposit_name","then","response","auth_fail","result","loadItems","offset","limit","changePage","o","onDeleted","onEdit","deposit_id","onNew","filterTable","closeAddNew","saveNew","deposit","updateExisting","closeUpdate","onEditReservesForDeposit","components","mounted"],"sources":["/Users/fayzulla/Dev/kadastr/frontend/kadastr/src/components/DepositsTable.vue"],"sourcesContent":["<template>\n  <div class=\"table\">\n    <Spinner v-if=\"showSpinner\" />\n    <OkModal\n      v-if=\"showAuthError\"\n      v-bind:message=\"authMessage\"\n      v-bind:header=\"authHeader\"\n      v-on:confirm=\"hideAuthMessage\"\n    />\n    <EditDepositModal\n      v-if=\"showEditDeposit\"\n      v-on:cancel=\"closeUpdate\"\n      v-on:save=\"updateExisting\"\n      v-bind:deposit_id=\"currentDepositId\"\n    />\n    <NewDepositModal\n      v-if=\"showAddNewDeposit\"\n      v-on:cancel=\"closeAddNew\"\n      v-on:save=\"saveNew\"\n    />\n    <Filter v-on:filter=\"filterTable\" v-bind:filterVal=\"filter\" />\n    <DepositItem\n      v-for=\"item in items\"\n      v-bind:key=\"item.deposit_id\"\n      v-bind:id_deposit=\"item.deposit_id\"\n      v-bind:deposit_name=\"item.deposit_name\"\n      v-bind:type_id=\"item.type_id\"\n      v-bind:type=\"item.type\"\n      v-on:deposit-edited=\"onEdit\"\n      v-on:deposit-deleted=\"onDeleted\"\n    />\n    <div class=\"separator\"></div>\n    <div class=\"add\">\n      <button\n        @click=\"onNew\"\n        class=\"btn btn-dark btn-md btn-block btn-add\"\n        style=\"width: 300px\"\n      >\n        <BootstrapIcon icon=\"plus-square-fill\" size=\"2x\" />\n        Добавить\n      </button>\n    </div>\n    <div class=\"separator\"></div>\n    <Paginator\n      v-bind:count=\"totalItems\"\n      v-bind:ipp=\"ipp\"\n      v-bind:currentPage=\"page\"\n      v-on:page-click=\"changePage\"\n      v-bind:autoMargin=\"true\"\n    />\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport BootstrapIcon from \"@dvuckovic/vue3-bootstrap-icons\";\n\nimport NewDepositModal from \"../components/NewDepositModal.vue\";\nimport EditDepositModal from \"../components/EditDepositModal.vue\";\nimport DepositItem from \"../components/DepositItem.vue\";\nimport Paginator from \"../components/Paginator.vue\";\nimport Filter from \"../components/Filter.vue\";\nimport Spinner from \"../components/Spinner.vue\";\nimport OkModal from \"./OkModal.vue\";\n\nexport default {\n  name: \"DepositsTable\",\n  props: [],\n  watch: {},\n  data() {\n    return {\n      items: [],\n      totalItems: 0,\n      showAddNewDeposit: false,\n      showEditDeposit: false,\n      currentDepositId: null,\n      page: 1,\n      ipp: 10,\n      filter: \"\",\n      loadedItems: 0,\n      showSpinner: true,\n      showAuthError: false,\n      authMessage: \"Доступ запрещен\",\n      authHeader: \"Ошибка безопасности\",\n    };\n  },\n  methods: {\n    hideAuthMessage() {\n      this.showAuthError = false;\n    },\n    countItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_deposits_count/\";\n      axios\n        .post(url, { deposit_name: this.filter }, { headers })\n        .then((response) => {\n          if (!response.data[0].auth_fail) {\n            this.totalItems = response.data[0].result;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    loadItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_deposits/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios\n        .post(\n          url,\n          { deposit_name: this.filter, offset: offset, limit: this.ipp },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data[0].auth_fail) {\n            this.items = response.data[0].result;\n            this.loadedItems = 0;\n            this.showSpinner = false;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    changePage(o) {\n      this.page = o.page;\n      this.loadItems();\n    },\n    onDeleted() {\n      this.page = 1;\n      this.filter = \"\";\n      this.countItems();\n      this.loadItems();\n    },\n    onEdit(o) {\n      this.currentDepositId = o.deposit_id;\n      this.showEditDeposit = true;\n    },\n    onNew() {\n      this.showAddNewDeposit = true;\n    },\n    filterTable(filter) {\n      this.page = 1;\n      this.filter = filter;\n      this.countItems();\n      this.loadItems();\n    },\n    closeAddNew() {\n      this.showAddNewDeposit = false;\n    },\n    saveNew(deposit) {\n      this.showAddNewDeposit = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/add_deposit/\";\n      axios.post(url, deposit, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    updateExisting(deposit) {\n      this.showEditDeposit = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/update_deposit/\";\n      axios.post(url, deposit, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.items = [];\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    closeUpdate() {\n      this.showEditDeposit = false;\n    },\n    onEditReservesForDeposit(o) {\n      this.currentDepositId = o.deposit_id;\n    },\n  },\n  components: {\n    BootstrapIcon,\n    EditDepositModal,\n    NewDepositModal,\n    DepositItem,\n    Paginator,\n    Filter,\n    Spinner,\n    OkModal,\n  },\n  mounted() {\n    this.showSpinner = true;\n    this.countItems();\n    this.loadItems();\n  },\n};\n</script>\n\n<style scoped>\n.table {\n  margin: auto;\n  width: calc(100% - 20px);\n  height: calc(100% - 20px);\n  border-top: none !important;\n  border-bottom: none !important;\n}\n.separator {\n  padding: 10px;\n  margin-left: 10px;\n  border-top: none !important;\n  border-bottom: none !important;\n}\n\n.add {\n  border-top: none !important;\n  border-bottom: none !important;\n}\n</style>\n"],"mappings":"AAsDA,OAAOA,KAAI,MAAO,OAAO;AACzB,OAAOC,aAAY,MAAO,iCAAiC;AAE3D,OAAOC,eAAc,MAAO,mCAAmC;AAC/D,OAAOC,gBAAe,MAAO,oCAAoC;AACjE,OAAOC,WAAU,MAAO,+BAA+B;AACvD,OAAOC,SAAQ,MAAO,6BAA6B;AACnD,OAAOC,MAAK,MAAO,0BAA0B;AAC7C,OAAOC,OAAM,MAAO,2BAA2B;AAC/C,OAAOC,OAAM,MAAO,eAAe;AAEnC,eAAe;EACbC,IAAI,EAAE,eAAe;EACrBC,KAAK,EAAE,EAAE;EACTC,KAAK,EAAE,CAAC,CAAC;EACTC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,KAAK,EAAE,EAAE;MACTC,UAAU,EAAE,CAAC;MACbC,iBAAiB,EAAE,KAAK;MACxBC,eAAe,EAAE,KAAK;MACtBC,gBAAgB,EAAE,IAAI;MACtBC,IAAI,EAAE,CAAC;MACPC,GAAG,EAAE,EAAE;MACPC,MAAM,EAAE,EAAE;MACVC,WAAW,EAAE,CAAC;MACdC,WAAW,EAAE,IAAI;MACjBC,aAAa,EAAE,KAAK;MACpBC,WAAW,EAAE,iBAAiB;MAC9BC,UAAU,EAAE;IACd,CAAC;EACH,CAAC;EACDC,OAAO,EAAE;IACPC,eAAeA,CAAA,EAAG;MAChB,IAAI,CAACJ,aAAY,GAAI,KAAK;IAC5B,CAAC;IACDK,UAAUA,CAAA,EAAG;MACX,MAAMC,KAAI,GAAIC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC;MAC7C,MAAMC,OAAM,GAAI;QACd,cAAc,EAAE,kBAAkB;QAClCC,aAAa,EAAE,SAAQ,GAAIJ;MAC7B,CAAC;MACD,IAAIK,GAAE,GAAI,IAAI,CAACC,SAAQ,GAAI,0BAA0B;MACrDnC,KAAI,CACDoC,IAAI,CAACF,GAAG,EAAE;QAAEG,YAAY,EAAE,IAAI,CAACjB;MAAO,CAAC,EAAE;QAAEY;MAAQ,CAAC,EACpDM,IAAI,CAAEC,QAAQ,IAAK;QAClB,IAAI,CAACA,QAAQ,CAAC3B,IAAI,CAAC,CAAC,CAAC,CAAC4B,SAAS,EAAE;UAC/B,IAAI,CAAC1B,UAAS,GAAIyB,QAAQ,CAAC3B,IAAI,CAAC,CAAC,CAAC,CAAC6B,MAAM;QAC3C,OAAO;UACL,IAAI,CAAClB,aAAY,GAAI,IAAI;QAC3B;MACF,CAAC,CAAC;IACN,CAAC;IACDmB,SAASA,CAAA,EAAG;MACV,MAAMb,KAAI,GAAIC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC;MAC7C,MAAMC,OAAM,GAAI;QACd,cAAc,EAAE,kBAAkB;QAClCC,aAAa,EAAE,SAAQ,GAAIJ;MAC7B,CAAC;MACD,IAAIK,GAAE,GAAI,IAAI,CAACC,SAAQ,GAAI,oBAAoB;MAC/C,MAAMQ,MAAK,GAAI,CAAC,IAAI,CAACzB,IAAG,GAAI,CAAC,IAAI,IAAI,CAACC,GAAG;MACzCnB,KAAI,CACDoC,IAAI,CACHF,GAAG,EACH;QAAEG,YAAY,EAAE,IAAI,CAACjB,MAAM;QAAEuB,MAAM,EAAEA,MAAM;QAAEC,KAAK,EAAE,IAAI,CAACzB;MAAI,CAAC,EAC9D;QAAEa;MAAQ,EACZ,CACCM,IAAI,CAAEC,QAAQ,IAAK;QAClB,IAAI,CAACA,QAAQ,CAAC3B,IAAI,CAAC,CAAC,CAAC,CAAC4B,SAAS,EAAE;UAC/B,IAAI,CAAC3B,KAAI,GAAI0B,QAAQ,CAAC3B,IAAI,CAAC,CAAC,CAAC,CAAC6B,MAAM;UACpC,IAAI,CAACpB,WAAU,GAAI,CAAC;UACpB,IAAI,CAACC,WAAU,GAAI,KAAK;QAC1B,OAAO;UACL,IAAI,CAACC,aAAY,GAAI,IAAI;QAC3B;MACF,CAAC,CAAC;IACN,CAAC;IACDsB,UAAUA,CAACC,CAAC,EAAE;MACZ,IAAI,CAAC5B,IAAG,GAAI4B,CAAC,CAAC5B,IAAI;MAClB,IAAI,CAACwB,SAAS,EAAE;IAClB,CAAC;IACDK,SAASA,CAAA,EAAG;MACV,IAAI,CAAC7B,IAAG,GAAI,CAAC;MACb,IAAI,CAACE,MAAK,GAAI,EAAE;MAChB,IAAI,CAACQ,UAAU,EAAE;MACjB,IAAI,CAACc,SAAS,EAAE;IAClB,CAAC;IACDM,MAAMA,CAACF,CAAC,EAAE;MACR,IAAI,CAAC7B,gBAAe,GAAI6B,CAAC,CAACG,UAAU;MACpC,IAAI,CAACjC,eAAc,GAAI,IAAI;IAC7B,CAAC;IACDkC,KAAKA,CAAA,EAAG;MACN,IAAI,CAACnC,iBAAgB,GAAI,IAAI;IAC/B,CAAC;IACDoC,WAAWA,CAAC/B,MAAM,EAAE;MAClB,IAAI,CAACF,IAAG,GAAI,CAAC;MACb,IAAI,CAACE,MAAK,GAAIA,MAAM;MACpB,IAAI,CAACQ,UAAU,EAAE;MACjB,IAAI,CAACc,SAAS,EAAE;IAClB,CAAC;IACDU,WAAWA,CAAA,EAAG;MACZ,IAAI,CAACrC,iBAAgB,GAAI,KAAK;IAChC,CAAC;IACDsC,OAAOA,CAACC,OAAO,EAAE;MACf,IAAI,CAACvC,iBAAgB,GAAI,KAAK;MAC9B,MAAMc,KAAI,GAAIC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC;MAC7C,MAAMC,OAAM,GAAI;QACd,cAAc,EAAE,kBAAkB;QAClCC,aAAa,EAAE,SAAQ,GAAIJ;MAC7B,CAAC;MACD,IAAIK,GAAE,GAAI,IAAI,CAACC,SAAQ,GAAI,mBAAmB;MAC9CnC,KAAK,CAACoC,IAAI,CAACF,GAAG,EAAEoB,OAAO,EAAE;QAAEtB;MAAQ,CAAC,CAAC,CAACM,IAAI,CAAEC,QAAQ,IAAK;QACvD,IAAI,CAACA,QAAQ,CAAC3B,IAAI,CAAC,CAAC,CAAC,CAAC4B,SAAS,EAAE;UAC/B,IAAI,CAACtB,IAAG,GAAI,CAAC;UACb,IAAI,CAACE,MAAK,GAAI,EAAE;UAChB,IAAI,CAACQ,UAAU,EAAE;UACjB,IAAI,CAACc,SAAS,EAAE;QAClB,OAAO;UACL,IAAI,CAACnB,aAAY,GAAI,IAAI;QAC3B;MACF,CAAC,CAAC;IACJ,CAAC;IACDgC,cAAcA,CAACD,OAAO,EAAE;MACtB,IAAI,CAACtC,eAAc,GAAI,KAAK;MAC5B,MAAMa,KAAI,GAAIC,cAAc,CAACC,OAAO,CAAC,OAAO,CAAC;MAC7C,MAAMC,OAAM,GAAI;QACd,cAAc,EAAE,kBAAkB;QAClCC,aAAa,EAAE,SAAQ,GAAIJ;MAC7B,CAAC;MACD,IAAIK,GAAE,GAAI,IAAI,CAACC,SAAQ,GAAI,sBAAsB;MACjDnC,KAAK,CAACoC,IAAI,CAACF,GAAG,EAAEoB,OAAO,EAAE;QAAEtB;MAAQ,CAAC,CAAC,CAACM,IAAI,CAAEC,QAAQ,IAAK;QACvD,IAAI,CAACA,QAAQ,CAAC3B,IAAI,CAAC,CAAC,CAAC,CAAC4B,SAAS,EAAE;UAC/B,IAAI,CAACtB,IAAG,GAAI,CAAC;UACb,IAAI,CAACE,MAAK,GAAI,EAAE;UAChB,IAAI,CAACP,KAAI,GAAI,EAAE;UACf,IAAI,CAACe,UAAU,EAAE;UACjB,IAAI,CAACc,SAAS,EAAE;QAClB,OAAO;UACL,IAAI,CAACnB,aAAY,GAAI,IAAI;QAC3B;MACF,CAAC,CAAC;IACJ,CAAC;IACDiC,WAAWA,CAAA,EAAG;MACZ,IAAI,CAACxC,eAAc,GAAI,KAAK;IAC9B,CAAC;IACDyC,wBAAwBA,CAACX,CAAC,EAAE;MAC1B,IAAI,CAAC7B,gBAAe,GAAI6B,CAAC,CAACG,UAAU;IACtC;EACF,CAAC;EACDS,UAAU,EAAE;IACVzD,aAAa;IACbE,gBAAgB;IAChBD,eAAe;IACfE,WAAW;IACXC,SAAS;IACTC,MAAM;IACNC,OAAO;IACPC;EACF,CAAC;EACDmD,OAAOA,CAAA,EAAG;IACR,IAAI,CAACrC,WAAU,GAAI,IAAI;IACvB,IAAI,CAACM,UAAU,EAAE;IACjB,IAAI,CAACc,SAAS,EAAE;EAClB;AACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}