{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-3ac4fa8e\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"table\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"separator\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_3 = {\n  class: \"add\"\n};\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"separator\"\n}, null, -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Spinner = _resolveComponent(\"Spinner\");\n  const _component_OkModal = _resolveComponent(\"OkModal\");\n  const _component_EditDepositModal = _resolveComponent(\"EditDepositModal\");\n  const _component_NewDepositModal = _resolveComponent(\"NewDepositModal\");\n  const _component_Filter = _resolveComponent(\"Filter\");\n  const _component_DepositItem = _resolveComponent(\"DepositItem\");\n  const _component_BootstrapIcon = _resolveComponent(\"BootstrapIcon\");\n  const _component_Paginator = _resolveComponent(\"Paginator\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$data.showSpinner ? (_openBlock(), _createBlock(_component_Spinner, {\n    key: 0\n  })) : _createCommentVNode(\"v-if\", true), $data.showAuthError ? (_openBlock(), _createBlock(_component_OkModal, {\n    key: 1,\n    message: $data.authMessage,\n    header: $data.authHeader,\n    onConfirm: $options.hideAuthMessage\n  }, null, 8 /* PROPS */, [\"message\", \"header\", \"onConfirm\"])) : _createCommentVNode(\"v-if\", true), $data.showEditDeposit ? (_openBlock(), _createBlock(_component_EditDepositModal, {\n    key: 2,\n    onCancel: $options.closeUpdate,\n    onSave: $options.updateExisting,\n    deposit_id: $data.currentDepositId\n  }, null, 8 /* PROPS */, [\"onCancel\", \"onSave\", \"deposit_id\"])) : _createCommentVNode(\"v-if\", true), $data.showAddNewDeposit ? (_openBlock(), _createBlock(_component_NewDepositModal, {\n    key: 3,\n    onCancel: $options.closeAddNew,\n    onSave: $options.saveNew\n  }, null, 8 /* PROPS */, [\"onCancel\", \"onSave\"])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_Filter, {\n    onFilter: $options.filterTable,\n    filterVal: $data.filter\n  }, null, 8 /* PROPS */, [\"onFilter\", \"filterVal\"]), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.items, item => {\n    return _openBlock(), _createBlock(_component_DepositItem, {\n      key: item.deposit_id,\n      id_deposit: item.deposit_id,\n      deposit_name: item.deposit_name,\n      type_id: item.type_id,\n      type: item.type,\n      onDepositEdited: $options.onEdit,\n      onDepositDeleted: $options.onDeleted\n    }, null, 8 /* PROPS */, [\"id_deposit\", \"deposit_name\", \"type_id\", \"type\", \"onDepositEdited\", \"onDepositDeleted\"]);\n  }), 128 /* KEYED_FRAGMENT */)), _hoisted_2, _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.onNew && $options.onNew(...args)),\n    class: \"btn btn-dark btn-md btn-block btn-add\",\n    style: {\n      \"width\": \"200px\"\n    }\n  }, [_createVNode(_component_BootstrapIcon, {\n    icon: \"plus-square-fill\"\n  }), _createTextVNode(\" Добавить \")])]), _hoisted_4, _createVNode(_component_Paginator, {\n    count: $data.totalItems,\n    ipp: $data.ipp,\n    currentPage: $data.page,\n    onPageClick: $options.changePage,\n    autoMargin: true\n  }, null, 8 /* PROPS */, [\"count\", \"ipp\", \"currentPage\", \"onPageClick\"])]);\n}","map":{"version":3,"names":["class","_createElementVNode","_createElementBlock","_hoisted_1","$data","showSpinner","_createBlock","_component_Spinner","key","showAuthError","_component_OkModal","message","authMessage","header","authHeader","onConfirm","$options","hideAuthMessage","showEditDeposit","_component_EditDepositModal","onCancel","closeUpdate","onSave","updateExisting","deposit_id","currentDepositId","showAddNewDeposit","_component_NewDepositModal","closeAddNew","saveNew","_createVNode","_component_Filter","onFilter","filterTable","filterVal","filter","_Fragment","_renderList","items","item","_component_DepositItem","id_deposit","deposit_name","type_id","type","onDepositEdited","onEdit","onDepositDeleted","onDeleted","_hoisted_2","_hoisted_3","onClick","_cache","args","onNew","style","_component_BootstrapIcon","icon","_hoisted_4","_component_Paginator","count","totalItems","ipp","currentPage","page","onPageClick","changePage","autoMargin"],"sources":["/Users/fayzulla/Dev/kadastr/frontend/kadastr/src/components/DepositsTable.vue"],"sourcesContent":["<template>\n  <div class=\"table\">\n    <Spinner v-if=\"showSpinner\" />\n    <OkModal\n      v-if=\"showAuthError\"\n      v-bind:message=\"authMessage\"\n      v-bind:header=\"authHeader\"\n      v-on:confirm=\"hideAuthMessage\"\n    />\n    <EditDepositModal\n      v-if=\"showEditDeposit\"\n      v-on:cancel=\"closeUpdate\"\n      v-on:save=\"updateExisting\"\n      v-bind:deposit_id=\"currentDepositId\"\n    />\n    <NewDepositModal\n      v-if=\"showAddNewDeposit\"\n      v-on:cancel=\"closeAddNew\"\n      v-on:save=\"saveNew\"\n    />\n    <Filter v-on:filter=\"filterTable\" v-bind:filterVal=\"filter\" />\n    <DepositItem\n      v-for=\"item in items\"\n      v-bind:key=\"item.deposit_id\"\n      v-bind:id_deposit=\"item.deposit_id\"\n      v-bind:deposit_name=\"item.deposit_name\"\n      v-bind:type_id=\"item.type_id\"\n      v-bind:type=\"item.type\"\n      v-on:deposit-edited=\"onEdit\"\n      v-on:deposit-deleted=\"onDeleted\"\n    />\n    <div class=\"separator\"></div>\n    <div class=\"add\">\n      <button\n        @click=\"onNew\"\n        class=\"btn btn-dark btn-md btn-block btn-add\"\n        style=\"width: 200px\"\n      >\n        <BootstrapIcon icon=\"plus-square-fill\" />\n        Добавить\n      </button>\n    </div>\n    <div class=\"separator\"></div>\n    <Paginator\n      v-bind:count=\"totalItems\"\n      v-bind:ipp=\"ipp\"\n      v-bind:currentPage=\"page\"\n      v-on:page-click=\"changePage\"\n      v-bind:autoMargin=\"true\"\n    />\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport BootstrapIcon from \"@dvuckovic/vue3-bootstrap-icons\";\n\nimport NewDepositModal from \"../components/NewDepositModal.vue\";\nimport EditDepositModal from \"../components/EditDepositModal.vue\";\nimport DepositItem from \"../components/DepositItem.vue\";\nimport Paginator from \"../components/Paginator.vue\";\nimport Filter from \"../components/Filter.vue\";\nimport Spinner from \"../components/Spinner.vue\";\nimport OkModal from \"./OkModal.vue\";\n\nexport default {\n  name: \"DepositsTable\",\n  props: [],\n  watch: {},\n  data() {\n    return {\n      items: [],\n      totalItems: 0,\n      showAddNewDeposit: false,\n      showEditDeposit: false,\n      currentDepositId: null,\n      page: 1,\n      ipp: 10,\n      filter: \"\",\n      loadedItems: 0,\n      showSpinner: true,\n      showAuthError: false,\n      authMessage: \"Доступ запрещен\",\n      authHeader: \"Ошибка безопасности\",\n    };\n  },\n  methods: {\n    hideAuthMessage() {\n      this.showAuthError = false;\n    },\n    countItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_deposits_count/\";\n      axios\n        .post(url, { deposit_name: this.filter }, { headers })\n        .then((response) => {\n          if (!response.data[0].auth_fail) {\n            this.totalItems = response.data[0].result;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    loadItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_deposits/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios\n        .post(\n          url,\n          { deposit_name: this.filter, offset: offset, limit: this.ipp },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data[0].auth_fail) {\n            this.items = response.data[0].result;\n            this.loadedItems = 0;\n            this.showSpinner = false;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    changePage(o) {\n      this.page = o.page;\n      this.loadItems();\n    },\n    onDeleted() {\n      this.page = 1;\n      this.filter = \"\";\n      this.countItems();\n      this.loadItems();\n    },\n    onEdit(o) {\n      this.currentDepositId = o.deposit_id;\n      this.showEditDeposit = true;\n    },\n    onNew() {\n      this.showAddNewDeposit = true;\n    },\n    filterTable(filter) {\n      this.page = 1;\n      this.filter = filter;\n      this.countItems();\n      this.loadItems();\n    },\n    closeAddNew() {\n      this.showAddNewDeposit = false;\n    },\n    saveNew(deposit) {\n      this.showAddNewDeposit = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/add_deposit/\";\n      axios.post(url, deposit, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    updateExisting(deposit) {\n      this.showEditDeposit = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/update_deposit/\";\n      axios.post(url, deposit, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.items = [];\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    closeUpdate() {\n      this.showEditDeposit = false;\n    },\n    onEditReservesForDeposit(o) {\n      this.currentDepositId = o.deposit_id;\n    },\n  },\n  components: {\n    BootstrapIcon,\n    EditDepositModal,\n    NewDepositModal,\n    DepositItem,\n    Paginator,\n    Filter,\n    Spinner,\n    OkModal,\n  },\n  mounted() {\n    this.showSpinner = true;\n    this.countItems();\n    this.loadItems();\n  },\n};\n</script>\n\n<style scoped>\n.table {\n  margin: auto;\n  width: calc(100% - 20px);\n  height: calc(100% - 20px);\n  border-top: none !important;\n  border-bottom: none !important;\n}\n.separator {\n  padding: 10px;\n  margin-left: 10px;\n  border-top: none !important;\n  border-bottom: none !important;\n}\n\n.add {\n  border-top: none !important;\n  border-bottom: none !important;\n}\n</style>\n"],"mappings":";;;EACOA,KAAK,EAAC;AAAO;gEA8BhBC,mBAAA,CAA6B;EAAxBD,KAAK,EAAC;AAAW;;EACjBA,KAAK,EAAC;AAAK;gEAUhBC,mBAAA,CAA6B;EAAxBD,KAAK,EAAC;AAAW;;;;;;;;;;;uBAzCxBE,mBAAA,CAiDM,OAjDNC,UAiDM,GAhDWC,KAAA,CAAAC,WAAW,I,cAA1BC,YAAA,CAA8BC,kBAAA;IAAAC,GAAA;EAAA,M,mCAEtBJ,KAAA,CAAAK,aAAa,I,cADrBH,YAAA,CAKEI,kBAAA;;IAHOC,OAAO,EAAEP,KAAA,CAAAQ,WAAW;IACpBC,MAAM,EAAET,KAAA,CAAAU,UAAU;IACpBC,SAAO,EAAEC,QAAA,CAAAC;oGAGRb,KAAA,CAAAc,eAAe,I,cADvBZ,YAAA,CAKEa,2BAAA;;IAHKC,QAAM,EAAEJ,QAAA,CAAAK,WAAW;IACnBC,MAAI,EAAEN,QAAA,CAAAO,cAAc;IAClBC,UAAU,EAAEpB,KAAA,CAAAqB;sGAGbrB,KAAA,CAAAsB,iBAAiB,I,cADzBpB,YAAA,CAIEqB,0BAAA;;IAFKP,QAAM,EAAEJ,QAAA,CAAAY,WAAW;IACnBN,MAAI,EAAEN,QAAA,CAAAa;wFAEbC,YAAA,CAA8DC,iBAAA;IAAjDC,QAAM,EAAEhB,QAAA,CAAAiB,WAAW;IAASC,SAAS,EAAE9B,KAAA,CAAA+B;yEACpDjC,mBAAA,CASEkC,SAAA,QAAAC,WAAA,CARejC,KAAA,CAAAkC,KAAK,EAAbC,IAAI;yBADbjC,YAAA,CASEkC,sBAAA;MAPOhC,GAAG,EAAE+B,IAAI,CAACf,UAAU;MACpBiB,UAAU,EAAEF,IAAI,CAACf,UAAU;MAC3BkB,YAAY,EAAEH,IAAI,CAACG,YAAY;MAC/BC,OAAO,EAAEJ,IAAI,CAACI,OAAO;MACrBC,IAAI,EAAEL,IAAI,CAACK,IAAI;MACjBC,eAAc,EAAE7B,QAAA,CAAA8B,MAAM;MACtBC,gBAAe,EAAE/B,QAAA,CAAAgC;;kCAExBC,UAA6B,EAC7BhD,mBAAA,CASM,OATNiD,UASM,GARJjD,mBAAA,CAOS;IANNkD,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAErC,QAAA,CAAAsC,KAAA,IAAAtC,QAAA,CAAAsC,KAAA,IAAAD,IAAA,CAAK;IACbrD,KAAK,EAAC,uCAAuC;IAC7CuD,KAAoB,EAApB;MAAA;IAAA;MAEAzB,YAAA,CAAyC0B,wBAAA;IAA1BC,IAAI,EAAC;EAAkB,I,iBAAG,YAE3C,E,KAEFC,UAA6B,EAC7B5B,YAAA,CAME6B,oBAAA;IALOC,KAAK,EAAExD,KAAA,CAAAyD,UAAU;IACjBC,GAAG,EAAE1D,KAAA,CAAA0D,GAAG;IACRC,WAAW,EAAE3D,KAAA,CAAA4D,IAAI;IACnBC,WAAU,EAAEjD,QAAA,CAAAkD,UAAU;IACpBC,UAAU,EAAE"},"metadata":{},"sourceType":"module","externalDependencies":[]}