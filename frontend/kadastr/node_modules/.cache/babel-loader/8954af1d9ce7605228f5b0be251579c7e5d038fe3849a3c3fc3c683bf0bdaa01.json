{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-293b99d6\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"table\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"separator\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_3 = {\n  class: \"add\"\n};\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"separator\"\n}, null, -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Spinner = _resolveComponent(\"Spinner\");\n  const _component_EditUserModal = _resolveComponent(\"EditUserModal\");\n  const _component_OkModal = _resolveComponent(\"OkModal\");\n  const _component_NewUserModal = _resolveComponent(\"NewUserModal\");\n  const _component_Filter = _resolveComponent(\"Filter\");\n  const _component_UserItem = _resolveComponent(\"UserItem\");\n  const _component_BootstrapIcon = _resolveComponent(\"BootstrapIcon\");\n  const _component_Paginator = _resolveComponent(\"Paginator\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$data.showSpinner ? (_openBlock(), _createBlock(_component_Spinner, {\n    key: 0\n  })) : _createCommentVNode(\"v-if\", true), $data.showEditUser ? (_openBlock(), _createBlock(_component_EditUserModal, {\n    key: 1,\n    onCancel: $options.closeUpdate,\n    onSave: $options.updateExisting,\n    user_id: $data.currentUserId\n  }, null, 8 /* PROPS */, [\"onCancel\", \"onSave\", \"user_id\"])) : _createCommentVNode(\"v-if\", true), $data.showAuthError ? (_openBlock(), _createBlock(_component_OkModal, {\n    key: 2,\n    message: $data.authMessage,\n    header: $data.authHeader,\n    onConfirm: $options.hideAuthMessage\n  }, null, 8 /* PROPS */, [\"message\", \"header\", \"onConfirm\"])) : _createCommentVNode(\"v-if\", true), $data.showAddNewUser ? (_openBlock(), _createBlock(_component_NewUserModal, {\n    key: 3,\n    onCancel: $options.closeAddNew,\n    onSave: $options.saveNew\n  }, null, 8 /* PROPS */, [\"onCancel\", \"onSave\"])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_Filter, {\n    onFilter: $options.filterTable,\n    filterVal: $data.filter\n  }, null, 8 /* PROPS */, [\"onFilter\", \"filterVal\"]), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.users, user => {\n    return _openBlock(), _createBlock(_component_UserItem, {\n      key: user.user_id,\n      user_id: user.user_id,\n      username: user.username,\n      role: user.role,\n      onUserEdited: $options.onEdit,\n      onUserDeleted: $options.onDeleted\n    }, null, 8 /* PROPS */, [\"user_id\", \"username\", \"role\", \"onUserEdited\", \"onUserDeleted\"]);\n  }), 128 /* KEYED_FRAGMENT */)), _hoisted_2, _createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = (...args) => $options.onNew && $options.onNew(...args)),\n    class: \"btn btn-dark btn-lg btn-block\",\n    style: {\n      \"width\": \"300px\"\n    }\n  }, [_createVNode(_component_BootstrapIcon, {\n    icon: \"plus\",\n    size: \"2x\"\n  }), _createTextVNode(\" Добавить \")])]), _hoisted_4, _createVNode(_component_Paginator, {\n    count: $data.totalItems,\n    ipp: $data.ipp,\n    currentPage: $data.page,\n    onPageClick: $options.changePage\n  }, null, 8 /* PROPS */, [\"count\", \"ipp\", \"currentPage\", \"onPageClick\"])]);\n}","map":{"version":3,"names":["class","_createElementVNode","_createElementBlock","_hoisted_1","$data","showSpinner","_createBlock","_component_Spinner","key","showEditUser","_component_EditUserModal","onCancel","$options","closeUpdate","onSave","updateExisting","user_id","currentUserId","showAuthError","_component_OkModal","message","authMessage","header","authHeader","onConfirm","hideAuthMessage","showAddNewUser","_component_NewUserModal","closeAddNew","saveNew","_createVNode","_component_Filter","onFilter","filterTable","filterVal","filter","_Fragment","_renderList","users","user","_component_UserItem","username","role","onUserEdited","onEdit","onUserDeleted","onDeleted","_hoisted_2","_hoisted_3","onClick","_cache","args","onNew","style","_component_BootstrapIcon","icon","size","_hoisted_4","_component_Paginator","count","totalItems","ipp","currentPage","page","onPageClick","changePage"],"sources":["/Users/fayzulla/Dev/kadastr/frontend/kadastr/src/components/UsersTable.vue"],"sourcesContent":["<template>\n  <div class=\"table\">\n    <Spinner v-if=\"showSpinner\" />\n    <EditUserModal\n      v-if=\"showEditUser\"\n      v-on:cancel=\"closeUpdate\"\n      v-on:save=\"updateExisting\"\n      v-bind:user_id=\"currentUserId\"\n    />\n    <OkModal\n      v-if=\"showAuthError\"\n      v-bind:message=\"authMessage\"\n      v-bind:header=\"authHeader\"\n      v-on:confirm=\"hideAuthMessage\"\n    />\n    <NewUserModal\n      v-if=\"showAddNewUser\"\n      v-on:cancel=\"closeAddNew\"\n      v-on:save=\"saveNew\"\n    />\n    <Filter v-on:filter=\"filterTable\" v-bind:filterVal=\"filter\" />\n    <UserItem\n      v-for=\"user in users\"\n      v-bind:key=\"user.user_id\"\n      v-bind:user_id=\"user.user_id\"\n      v-bind:username=\"user.username\"\n      v-bind:role=\"user.role\"\n      v-on:user-edited=\"onEdit\"\n      v-on:user-deleted=\"onDeleted\"\n    />\n    <div class=\"separator\"></div>\n    <div class=\"add\">\n      <button\n        @click=\"onNew\"\n        class=\"btn btn-dark btn-lg btn-block\"\n        style=\"width: 300px\"\n      >\n        <BootstrapIcon icon=\"plus\" size=\"2x\" />\n        Добавить\n      </button>\n    </div>\n    <div class=\"separator\"></div>\n    <Paginator\n      v-bind:count=\"totalItems\"\n      v-bind:ipp=\"ipp\"\n      v-bind:currentPage=\"page\"\n      v-on:page-click=\"changePage\"\n    />\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport BootstrapIcon from \"@dvuckovic/vue3-bootstrap-icons\";\n\nimport NewUserModal from \"../components/NewUserModal.vue\";\nimport EditUserModal from \"../components/EditUserModal.vue\";\nimport UserItem from \"../components/UserItem.vue\";\nimport Paginator from \"../components/Paginator.vue\";\nimport Filter from \"../components/Filter.vue\";\nimport Spinner from \"../components/Spinner.vue\";\nimport OkModal from \"../components/OkModal.vue\";\n\nexport default {\n  name: \"UsersTable\",\n  props: [],\n  watch: {},\n  data() {\n    return {\n      users: [],\n      totalItems: 0,\n      showAddNewUser: false,\n      showEditUser: false,\n      currentUserId: null,\n      page: 1,\n      ipp: 10,\n      filter: \"\",\n      loadedItems: 0,\n      showSpinner: true,\n      showAuthError: false,\n      authMessage: \"Доступ запрещен\",\n      authHeader: \"Ошибка безопасности\",\n    };\n  },\n  methods: {\n    hideAuthMessage() {\n      this.showAuthError = false;\n    },\n    countItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_users_count/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios\n        .post(\n          url,\n          { username: this.filter, offset: offset, limit: this.ipp },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data.auth_fail) {\n            this.totalItems = response.data.result;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    loadItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_users/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios\n        .post(\n          url,\n          { username: this.filter, offset: offset, limit: this.ipp },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data[0].auth_fail) {\n            this.users = response.data[0].result;\n            this.loadedItems = 0;\n            this.showSpinner = false;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    changePage(o) {\n      this.page = o.page;\n      this.loadItems();\n    },\n    onDeleted() {\n      this.page = 1;\n      this.filter = \"\";\n      this.countItems();\n      this.loadItems();\n    },\n    onEdit(o) {\n      this.currentUserId = o.user_id;\n      this.showEditUser = true;\n    },\n    onNew() {\n      this.showAddNewUser = true;\n    },\n    filterTable(filter) {\n      this.filter = filter;\n      this.countItems();\n      this.loadItems();\n    },\n    closeAddNew() {\n      this.showAddNewUser = false;\n    },\n    saveNew(user) {\n      this.showAddNewUser = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/add_user/\";\n      axios.post(url, user, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    updateExisting(user) {\n      this.showEditUser = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/update_user/\";\n      axios.post(url, user, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.items = [];\n          this.countItems();\n          this.loadItems();\n        }\n      });\n    },\n    closeUpdate() {\n      this.showEditUser = false;\n    },\n  },\n  components: {\n    BootstrapIcon,\n    NewUserModal,\n    EditUserModal,\n    UserItem,\n    Paginator,\n    Filter,\n    Spinner,\n    OkModal,\n  },\n  mounted() {\n    this.showSpinner = true;\n    this.countItems();\n    this.loadItems();\n  },\n};\n</script>\n\n<style scoped>\n.table {\n  margin: auto;\n  width: calc(100% - 20px);\n  height: calc(100% - 20px);\n  border-top: none !important;\n  border-bottom: none !important;\n}\n.separator {\n  padding: 10px;\n  margin-left: 10px;\n  border-top: none !important;\n  border-bottom: none !important;\n}\n\n.add {\n  border-top: none !important;\n  border-bottom: none !important;\n}\n</style>\n"],"mappings":";;;EACOA,KAAK,EAAC;AAAO;gEA6BhBC,mBAAA,CAA6B;EAAxBD,KAAK,EAAC;AAAW;;EACjBA,KAAK,EAAC;AAAK;gEAUhBC,mBAAA,CAA6B;EAAxBD,KAAK,EAAC;AAAW;;;;;;;;;;;uBAxCxBE,mBAAA,CA+CM,OA/CNC,UA+CM,GA9CWC,KAAA,CAAAC,WAAW,I,cAA1BC,YAAA,CAA8BC,kBAAA;IAAAC,GAAA;EAAA,M,mCAEtBJ,KAAA,CAAAK,YAAY,I,cADpBH,YAAA,CAKEI,wBAAA;;IAHKC,QAAM,EAAEC,QAAA,CAAAC,WAAW;IACnBC,MAAI,EAAEF,QAAA,CAAAG,cAAc;IAClBC,OAAO,EAAEZ,KAAA,CAAAa;mGAGVb,KAAA,CAAAc,aAAa,I,cADrBZ,YAAA,CAKEa,kBAAA;;IAHOC,OAAO,EAAEhB,KAAA,CAAAiB,WAAW;IACpBC,MAAM,EAAElB,KAAA,CAAAmB,UAAU;IACpBC,SAAO,EAAEZ,QAAA,CAAAa;oGAGRrB,KAAA,CAAAsB,cAAc,I,cADtBpB,YAAA,CAIEqB,uBAAA;;IAFKhB,QAAM,EAAEC,QAAA,CAAAgB,WAAW;IACnBd,MAAI,EAAEF,QAAA,CAAAiB;wFAEbC,YAAA,CAA8DC,iBAAA;IAAjDC,QAAM,EAAEpB,QAAA,CAAAqB,WAAW;IAASC,SAAS,EAAE9B,KAAA,CAAA+B;yEACpDjC,mBAAA,CAQEkC,SAAA,QAAAC,WAAA,CAPejC,KAAA,CAAAkC,KAAK,EAAbC,IAAI;yBADbjC,YAAA,CAQEkC,mBAAA;MANOhC,GAAG,EAAE+B,IAAI,CAACvB,OAAO;MACjBA,OAAO,EAAEuB,IAAI,CAACvB,OAAO;MACrByB,QAAQ,EAAEF,IAAI,CAACE,QAAQ;MACvBC,IAAI,EAAEH,IAAI,CAACG,IAAI;MACjBC,YAAW,EAAE/B,QAAA,CAAAgC,MAAM;MACnBC,aAAY,EAAEjC,QAAA,CAAAkC;;kCAErBC,UAA6B,EAC7B9C,mBAAA,CASM,OATN+C,UASM,GARJ/C,mBAAA,CAOS;IANNgD,OAAK,EAAAC,MAAA,QAAAA,MAAA,UAAAC,IAAA,KAAEvC,QAAA,CAAAwC,KAAA,IAAAxC,QAAA,CAAAwC,KAAA,IAAAD,IAAA,CAAK;IACbnD,KAAK,EAAC,+BAA+B;IACrCqD,KAAoB,EAApB;MAAA;IAAA;MAEAvB,YAAA,CAAuCwB,wBAAA;IAAxBC,IAAI,EAAC,MAAM;IAACC,IAAI,EAAC;uBAAO,YAEzC,E,KAEFC,UAA6B,EAC7B3B,YAAA,CAKE4B,oBAAA;IAJOC,KAAK,EAAEvD,KAAA,CAAAwD,UAAU;IACjBC,GAAG,EAAEzD,KAAA,CAAAyD,GAAG;IACRC,WAAW,EAAE1D,KAAA,CAAA2D,IAAI;IACnBC,WAAU,EAAEpD,QAAA,CAAAqD"},"metadata":{},"sourceType":"module","externalDependencies":[]}