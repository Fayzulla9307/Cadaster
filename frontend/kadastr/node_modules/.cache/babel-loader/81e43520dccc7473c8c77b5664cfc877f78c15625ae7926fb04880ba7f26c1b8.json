{"ast":null,"code":"import axios from \"axios\";\nimport BootstrapIcon from \"@dvuckovic/vue3-bootstrap-icons\";\nimport NewUserModal from \"../components/NewUserModal.vue\";\nimport EditUserModal from \"../components/EditUserModal.vue\";\nimport UserItem from \"../components/UserItem.vue\";\nimport Paginator from \"../components/Paginator.vue\";\nimport Filter from \"../components/Filter.vue\";\nimport Spinner from \"../components/Spinner.vue\";\nimport OkModal from \"../components/OkModal.vue\";\nexport default {\n  name: \"UsersTable\",\n  props: [],\n  watch: {},\n  data() {\n    return {\n      users: [],\n      totalItems: 0,\n      showAddNewUser: false,\n      showEditUser: false,\n      currentUserId: null,\n      page: 1,\n      ipp: 10,\n      filter: \"\",\n      loadedItems: 0,\n      showSpinner: true,\n      showAuthError: false,\n      authMessage: \"Доступ запрещен\",\n      authHeader: \"Ошибка безопасности\"\n    };\n  },\n  methods: {\n    hideAuthMessage() {\n      this.showAuthError = false;\n    },\n    countItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/get_users_count/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios.post(url, {\n        username: this.filter,\n        offset: offset,\n        limit: this.ipp\n      }, {\n        headers\n      }).then(response => {\n        if (!response.data.auth_fail) {\n          this.totalItems = response.data.result;\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    loadItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/get_users/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios.post(url, {\n        username: this.filter,\n        offset: offset,\n        limit: this.ipp\n      }, {\n        headers\n      }).then(response => {\n        if (!response.data[0].auth_fail) {\n          this.users = response.data[0].result;\n          this.loadedItems = 0;\n          this.showSpinner = false;\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    changePage(o) {\n      this.page = o.page;\n      this.loadItems();\n    },\n    onDeleted() {\n      this.page = 1;\n      this.filter = \"\";\n      this.countItems();\n      this.loadItems();\n    },\n    onEdit(o) {\n      this.currentUserId = o.user_id;\n      this.showEditUser = true;\n    },\n    onNew() {\n      this.showAddNewUser = true;\n    },\n    filterTable(filter) {\n      this.filter = filter;\n      this.countItems();\n      this.loadItems();\n    },\n    closeAddNew() {\n      this.showAddNewUser = false;\n    },\n    saveNew(user) {\n      this.showAddNewUser = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/add_user/\";\n      axios.post(url, user, {\n        headers\n      }).then(response => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    updateExisting(user) {\n      this.showEditUser = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token\n      };\n      var url = this.$BASE_URL + \"/api/update_user/\";\n      axios.post(url, user, {\n        headers\n      }).then(response => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.items = [];\n          this.countItems();\n          this.loadItems();\n        }\n      });\n    },\n    closeUpdate() {\n      this.showEditUser = false;\n    }\n  },\n  components: {\n    BootstrapIcon,\n    NewUserModal,\n    EditUserModal,\n    UserItem,\n    Paginator,\n    Filter,\n    Spinner,\n    OkModal\n  },\n  mounted() {\n    this.showSpinner = true;\n    this.countItems();\n    this.loadItems();\n  }\n};","map":{"version":3,"names":["axios","BootstrapIcon","NewUserModal","EditUserModal","UserItem","Paginator","Filter","Spinner","OkModal","name","props","watch","data","users","totalItems","showAddNewUser","showEditUser","currentUserId","page","ipp","filter","loadedItems","showSpinner","showAuthError","authMessage","authHeader","methods","hideAuthMessage","countItems","token","sessionStorage","getItem","headers","Authorization","url","$BASE_URL","offset","post","username","limit","then","response","auth_fail","result","loadItems","changePage","o","onDeleted","onEdit","user_id","onNew","filterTable","closeAddNew","saveNew","user","updateExisting","items","closeUpdate","components","mounted"],"sources":["/Users/fayzulla/Dev/kadastr/frontend/kadastr/src/components/UsersTable.vue"],"sourcesContent":["<template>\n  <div class=\"table\">\n    <Spinner v-if=\"showSpinner\" />\n    <EditUserModal\n      v-if=\"showEditUser\"\n      v-on:cancel=\"closeUpdate\"\n      v-on:save=\"updateExisting\"\n      v-bind:user_id=\"currentUserId\"\n    />\n    <OkModal\n      v-if=\"showAuthError\"\n      v-bind:message=\"authMessage\"\n      v-bind:header=\"authHeader\"\n      v-on:confirm=\"hideAuthMessage\"\n    />\n    <NewUserModal\n      v-if=\"showAddNewUser\"\n      v-on:cancel=\"closeAddNew\"\n      v-on:save=\"saveNew\"\n    />\n    <Filter v-on:filter=\"filterTable\" v-bind:filterVal=\"filter\" />\n    <UserItem\n      v-for=\"user in users\"\n      v-bind:key=\"user.user_id\"\n      v-bind:user_id=\"user.user_id\"\n      v-bind:username=\"user.username\"\n      v-bind:role=\"user.role\"\n      v-on:user-edited=\"onEdit\"\n      v-on:user-deleted=\"onDeleted\"\n    />\n    <div class=\"separator\"></div>\n    <div class=\"add\">\n      <button\n        @click=\"onNew\"\n        class=\"btn btn-dark btn-lg btn-block\"\n        style=\"width: 300px\"\n      >\n        <BootstrapIcon icon=\"plus\" size=\"2x\" />\n        Добавить\n      </button>\n    </div>\n    <div class=\"separator\"></div>\n    <Paginator\n      v-bind:count=\"totalItems\"\n      v-bind:ipp=\"ipp\"\n      v-bind:currentPage=\"page\"\n      v-on:page-click=\"changePage\"\n    />\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport BootstrapIcon from \"@dvuckovic/vue3-bootstrap-icons\";\n\nimport NewUserModal from \"../components/NewUserModal.vue\";\nimport EditUserModal from \"../components/EditUserModal.vue\";\nimport UserItem from \"../components/UserItem.vue\";\nimport Paginator from \"../components/Paginator.vue\";\nimport Filter from \"../components/Filter.vue\";\nimport Spinner from \"../components/Spinner.vue\";\nimport OkModal from \"../components/OkModal.vue\";\n\nexport default {\n  name: \"UsersTable\",\n  props: [],\n  watch: {},\n  data() {\n    return {\n      users: [],\n      totalItems: 0,\n      showAddNewUser: false,\n      showEditUser: false,\n      currentUserId: null,\n      page: 1,\n      ipp: 10,\n      filter: \"\",\n      loadedItems: 0,\n      showSpinner: true,\n      showAuthError: false,\n      authMessage: \"Доступ запрещен\",\n      authHeader: \"Ошибка безопасности\",\n    };\n  },\n  methods: {\n    hideAuthMessage() {\n      this.showAuthError = false;\n    },\n    countItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_users_count/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios\n        .post(\n          url,\n          { username: this.filter, offset: offset, limit: this.ipp },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data.auth_fail) {\n            this.totalItems = response.data.result;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    loadItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_users/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios\n        .post(\n          url,\n          { username: this.filter, offset: offset, limit: this.ipp },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data[0].auth_fail) {\n            this.users = response.data[0].result;\n            this.loadedItems = 0;\n            this.showSpinner = false;\n          } else {\n            this.showAuthError = true;\n          }\n        });\n    },\n    changePage(o) {\n      this.page = o.page;\n      this.loadItems();\n    },\n    onDeleted() {\n      this.page = 1;\n      this.filter = \"\";\n      this.countItems();\n      this.loadItems();\n    },\n    onEdit(o) {\n      this.currentUserId = o.user_id;\n      this.showEditUser = true;\n    },\n    onNew() {\n      this.showAddNewUser = true;\n    },\n    filterTable(filter) {\n      this.filter = filter;\n      this.countItems();\n      this.loadItems();\n    },\n    closeAddNew() {\n      this.showAddNewUser = false;\n    },\n    saveNew(user) {\n      this.showAddNewUser = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/add_user/\";\n      axios.post(url, user, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.countItems();\n          this.loadItems();\n        } else {\n          this.showAuthError = true;\n        }\n      });\n    },\n    updateExisting(user) {\n      this.showEditUser = false;\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/update_user/\";\n      axios.post(url, user, { headers }).then((response) => {\n        if (!response.data[0].auth_fail) {\n          this.page = 1;\n          this.filter = \"\";\n          this.items = [];\n          this.countItems();\n          this.loadItems();\n        }\n      });\n    },\n    closeUpdate() {\n      this.showEditUser = false;\n    },\n  },\n  components: {\n    BootstrapIcon,\n    NewUserModal,\n    EditUserModal,\n    UserItem,\n    Paginator,\n    Filter,\n    Spinner,\n    OkModal,\n  },\n  mounted() {\n    this.showSpinner = true;\n    this.countItems();\n    this.loadItems();\n  },\n};\n</script>\n\n<style scoped>\n.table {\n  margin: auto;\n  width: calc(100% - 20px);\n  height: calc(100% - 20px);\n  border-top: none !important;\n  border-bottom: none !important;\n}\n.separator {\n  padding: 10px;\n  margin-left: 10px;\n  border-top: none !important;\n  border-bottom: none !important;\n}\n\n.add {\n  border-top: none !important;\n  border-bottom: none !important;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}