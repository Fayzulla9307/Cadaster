{"ast":null,"code":"import { resolveComponent as _resolveComponent, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createVNode as _createVNode, renderList as _renderList, Fragment as _Fragment, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-ca68ab0e\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"table\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Spinner = _resolveComponent(\"Spinner\");\n  const _component_Filter = _resolveComponent(\"Filter\");\n  const _component_PropertyItem = _resolveComponent(\"PropertyItem\");\n  const _component_ProperyNewItem = _resolveComponent(\"ProperyNewItem\");\n  const _component_Paginator = _resolveComponent(\"Paginator\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [$data.showSpinner ? (_openBlock(), _createBlock(_component_Spinner, {\n    key: 0\n  })) : _createCommentVNode(\"v-if\", true), _createVNode(_component_Filter, {\n    onFilter: $options.filterTable,\n    filterVal: $data.filter\n  }, null, 8 /* PROPS */, [\"onFilter\", \"filterVal\"]), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.items, item => {\n    return _openBlock(), _createBlock(_component_PropertyItem, {\n      key: item.id,\n      displayButtons: true,\n      id: item.id,\n      category: item.category,\n      description: item.description,\n      onUpdated: $options.updated,\n      onLoaded: $options.onItemLoaded\n    }, null, 8 /* PROPS */, [\"id\", \"category\", \"description\", \"onUpdated\", \"onLoaded\"]);\n  }), 128 /* KEYED_FRAGMENT */)), _createVNode(_component_ProperyNewItem, {\n    category: $data.categoryLocal,\n    onUpdated: $options.updated\n  }, null, 8 /* PROPS */, [\"category\", \"onUpdated\"]), _createVNode(_component_Paginator, {\n    count: $data.totalItems,\n    ipp: $data.ipp,\n    currentPage: $data.page,\n    onPageClick: $options.changePage\n  }, null, 8 /* PROPS */, [\"count\", \"ipp\", \"currentPage\", \"onPageClick\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","$data","showSpinner","_createBlock","_component_Spinner","key","_createVNode","_component_Filter","onFilter","$options","filterTable","filterVal","filter","_Fragment","_renderList","items","item","_component_PropertyItem","id","displayButtons","category","description","onUpdated","updated","onLoaded","onItemLoaded","_component_ProperyNewItem","categoryLocal","_component_Paginator","count","totalItems","ipp","currentPage","page","onPageClick","changePage"],"sources":["/Users/fayzulla/Dev/kadastr/frontend/kadastr/src/components/PropertyTable.vue"],"sourcesContent":["<template>\n  <div class=\"table\">\n    <Spinner v-if=\"showSpinner\" />\n    <Filter v-on:filter=\"filterTable\" v-bind:filterVal=\"filter\" />\n    <PropertyItem\n      v-for=\"item in items\"\n      v-bind:key=\"item.id\"\n      v-bind:displayButtons=\"true\"\n      v-bind:id=\"item.id\"\n      v-bind:category=\"item.category\"\n      v-bind:description=\"item.description\"\n      v-on:updated=\"updated\"\n      v-on:loaded=\"onItemLoaded\"\n    />\n    <ProperyNewItem v-bind:category=\"categoryLocal\" v-on:updated=\"updated\" />\n    <Paginator\n      v-bind:count=\"totalItems\"\n      v-bind:ipp=\"ipp\"\n      v-bind:currentPage=\"page\"\n      v-on:page-click=\"changePage\"\n    />\n  </div>\n</template>\n\n<script>\nimport axios from \"axios\";\nimport PropertyItem from \"../components/PropertyItem.vue\";\nimport ProperyNewItem from \"../components/PropertyNewItem.vue\";\nimport Paginator from \"../components/Paginator.vue\";\nimport Filter from \"../components/Filter.vue\";\nimport Spinner from \"../components/Spinner.vue\";\n\nexport default {\n  name: \"PropertyTable\",\n  props: [\"category\"],\n  watch: {\n    category: {\n      deep: true,\n      handler(n) {\n        this.categoryLocal = n;\n        this.page = 1;\n        this.countItems();\n        this.loadItems();\n      },\n    },\n  },\n  data() {\n    return {\n      items: [],\n      categoryLocal: this.category,\n      totalItems: 0,\n      page: 1,\n      ipp: 10,\n      filter: \"\",\n      loadedItems: 0,\n      showSpinner: true,\n    };\n  },\n  methods: {\n    countItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_dictionary_count/\";\n      axios\n        .post(\n          url,\n          { category: this.categoryLocal, item: this.filter },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data.auth_fail) {\n            this.totalItems = response.data.result;\n          }\n        });\n    },\n    loadItems() {\n      const token = sessionStorage.getItem(\"token\");\n      const headers = {\n        \"Content-Type\": \"application/json\",\n        Authorization: \"Bearer \" + token,\n      };\n      var url = this.$BASE_URL + \"/api/get_dictionary_contents/\";\n      const offset = (this.page - 1) * this.ipp;\n      axios\n        .post(\n          url,\n          {\n            category: this.categoryLocal,\n            item: this.filter,\n            offset: offset,\n            limit: this.ipp,\n          },\n          { headers }\n        )\n        .then((response) => {\n          if (!response.data[0].auth_fail) {\n            console.log(JSON.stringify(response.data[0].result));\n            this.items = response.data[0].result;\n          }\n        });\n    },\n    onItemLoaded() {\n      this.loadedItems++;\n      //alert(this.totalItems + \" \" + this.loadedItems)\n      if (this.loadedItems == this.ipp) {\n        this.loadedItems = 0;\n        this.showSpinner = false;\n      }\n      if (\n        this.loadedItems == 0 &&\n        this.totalItems - this.ipp * Math.floor(this.totalItems / this.ipp)\n      ) {\n        this.loadedItems = 0;\n        this.showSpinner = false;\n      }\n      if (this.loadedItems == this.totalItems) {\n        this.loadedItems = 0;\n        this.showSpinner = false;\n      }\n    },\n    changePage(o) {\n      this.page = o.page;\n      this.loadItems();\n    },\n    updated() {\n      this.page = 1;\n      this.filter = \"\";\n      this.countItems();\n      this.loadItems();\n    },\n    filterTable(filter) {\n      this.page = 1;\n      this.filter = filter;\n      this.countItems();\n      this.loadItems();\n    },\n  },\n  components: {\n    PropertyItem,\n    ProperyNewItem,\n    Paginator,\n    Filter,\n    Spinner,\n  },\n  mounted() {\n    this.countItems();\n    this.loadItems();\n  },\n};\n</script>\n\n<style scoped>\n.table {\n  width: 100%;\n  height: 100%;\n}\n</style>\n"],"mappings":";;;EACOA,KAAK,EAAC;AAAO;;;;;;;uBAAlBC,mBAAA,CAoBM,OApBNC,UAoBM,GAnBWC,KAAA,CAAAC,WAAW,I,cAA1BC,YAAA,CAA8BC,kBAAA;IAAAC,GAAA;EAAA,M,mCAC9BC,YAAA,CAA8DC,iBAAA;IAAjDC,QAAM,EAAEC,QAAA,CAAAC,WAAW;IAASC,SAAS,EAAEV,KAAA,CAAAW;yEACpDb,mBAAA,CASEc,SAAA,QAAAC,WAAA,CAReb,KAAA,CAAAc,KAAK,EAAbC,IAAI;yBADbb,YAAA,CASEc,uBAAA;MAPOZ,GAAG,EAAEW,IAAI,CAACE,EAAE;MACZC,cAAc,EAAE,IAAI;MACpBD,EAAE,EAAEF,IAAI,CAACE,EAAE;MACXE,QAAQ,EAAEJ,IAAI,CAACI,QAAQ;MACvBC,WAAW,EAAEL,IAAI,CAACK,WAAW;MAC/BC,SAAO,EAAEb,QAAA,CAAAc,OAAO;MAChBC,QAAM,EAAEf,QAAA,CAAAgB;;kCAEfnB,YAAA,CAAyEoB,yBAAA;IAAlDN,QAAQ,EAAEnB,KAAA,CAAA0B,aAAa;IAAOL,SAAO,EAAEb,QAAA,CAAAc;sDAC9DjB,YAAA,CAKEsB,oBAAA;IAJOC,KAAK,EAAE5B,KAAA,CAAA6B,UAAU;IACjBC,GAAG,EAAE9B,KAAA,CAAA8B,GAAG;IACRC,WAAW,EAAE/B,KAAA,CAAAgC,IAAI;IACnBC,WAAU,EAAEzB,QAAA,CAAA0B"},"metadata":{},"sourceType":"module","externalDependencies":[]}